<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>steper music house</title>
  <meta name="description" content="ì¹´í…Œê³ ë¦¬ë³„ ìŒì•… ë§í¬ â€” steper music house" />
  <meta name="theme-color" content="#0b0e14" />
  <style>
    :root{ --bg:#0a0f1c; --panel:rgba(14,20,34,.7); --card:rgba(18,24,40,.75);
           --border:#24314b; --text:#e7ecf7; --muted:#9fb0c8; --accent:#86b7ff; --accent-2:#7dd3fc; }
    :root[data-theme="light"]{ --bg:#f6f9ff; --panel:rgba(255,255,255,.75); --card:#ffffff;
           --border:#e6ecf5; --text:#0f172a; --muted:#5a6473; --accent:#2563eb; --accent-2:#0891b2; }
    *{box-sizing:border-box} html,body{height:100%}
    body{ margin:0; background:radial-gradient(1200px 800px at 20% -10%, rgba(99,102,241,.12), transparent 60%),
                        radial-gradient(1000px 600px at 100% 0%, rgba(56,189,248,.10), transparent 50%), var(--bg);
          color:var(--text); font:15px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif; }
    a{color:var(--accent); text-decoration:none}
    .header{position:sticky; top:0; z-index:30; backdrop-filter:blur(8px);
             background:linear-gradient(180deg, rgba(10,15,28,.9), rgba(10,15,28,.6)); border-bottom:1px solid var(--border)}
    :root[data-theme="light"] .header{background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.6))}
    .wrap{max-width:1200px; margin:0 auto; padding:14px 18px}
    .row{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
    .grow{flex:1}
    .brand{display:flex; align-items:center; gap:10px}
    .brand img.logo{height:40px; width:auto; border-radius:10px; box-shadow:0 8px 22px rgba(0,0,0,.25)}
    .brand h1{font-size:22px; margin:0}
    .toolbar{display:flex; gap:8px; flex-wrap:wrap}
    .chip{border:1px solid var(--border); background:var(--panel); color:var(--text); padding:8px 14px; border-radius:999px; cursor:pointer}
    .chip.active, .chip:hover{border-color:var(--accent); color:var(--accent)}
    .controls{display:flex; gap:10px; flex-wrap:wrap}
    .controls input, .controls button, .controls select{background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:12px; padding:10px 12px}
    .btn-primary{background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#0b0e14; border:0; font-weight:700}
    main{max-width:1200px; margin:22px auto; padding:0 18px; display:grid; gap:18px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 12px 32px rgba(0,0,0,.28)}
    .list{display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:14px}
    @media (max-width:1100px){.list{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:720px){.list{grid-template-columns:1fr}}
    .tile{border:1px solid var(--border); border-radius:14px; overflow:hidden; background:var(--panel); display:flex; flex-direction:column}
    .thumb{position:relative; padding-top:56%; background:#0b0e14}
    .thumb img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
    .tile .body{padding:12px; display:flex; flex-direction:column; gap:10px}
    .tile h3{margin:0; font-size:16px; line-height:1.45}
    .muted{color:var(--muted)}
    .pill{display:inline-block; padding:4px 10px; border:1px solid var(--border); border-radius:999px; font-size:12px}
    .actions{margin-top:auto; display:flex; gap:10px}
    .btn-open{flex:1; text-align:center; font-weight:800; letter-spacing:.5px; padding:12px 14px; font-size:15px;
               background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#0a0f1c; border:0; border-radius:12px; cursor:pointer}
    .btn-outline{padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:transparent; color:var(--text); cursor:pointer}
    .btn-outline:hover{border-color:var(--accent)}
    .footer{border-top:1px solid var(--border); text-align:center; padding:16px; color:var(--muted)}
    dialog{border:1px solid var(--border); border-radius:14px; background:var(--card); color:var(--text); max-width:720px; width:92%}
    dialog::backdrop{background:rgba(0,0,0,.5)}
    .modal-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
    .grid2{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px}
    @media (max-width:800px){.grid2{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="header">
    <div class="wrap row">
      <a class="brand" href="./" title="í™ˆìœ¼ë¡œ">
        <img class="logo" src="images/logo.jpeg" alt="steper music house logo" />
        <h1>steper music house</h1>
      </a>
      <div class="toolbar grow" id="catBar"></div>
      <div class="controls">
        <input id="q" placeholder="ê²€ìƒ‰: ì œëª©/ì•„í‹°ìŠ¤íŠ¸/íƒœê·¸/ë©”ëª¨ ( / )" />
        <select id="sort">
          <option value="addedDesc">ìµœì‹ ìˆœ</option>
          <option value="addedAsc">ì˜¤ë˜ëœìˆœ</option>
          <option value="titleAsc">ì œëª© Aâ†’Z</option>
          <option value="titleDesc">ì œëª© Zâ†’A</option>
        </select>
        <button id="theme" title="í…Œë§ˆ ì „í™˜" class="btn-outline">ğŸŒ“</button>
        <button id="addBtn" class="btn-primary">ì¶”ê°€</button>
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="row" style="justify-content:space-between; align-items:center">
        <h2 style="margin:0">ë¦¬ìŠ¤íŠ¸</h2>
        <div class="row" style="gap:10px; flex-wrap:wrap">
          <input id="tagFilter" placeholder="#íƒœê·¸ í•„í„° (ì‰¼í‘œ/ìŠ¤í˜ì´ìŠ¤)" />
          <button id="exportJSON" class="btn-outline">JSON ë‚´ë³´ë‚´ê¸°</button>
        </div>
      </div>
      <div id="empty" class="muted" style="padding:8px 2px">ì•„ì§ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ì˜ <b>ì¶”ê°€</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.</div>
      <div id="list" class="list"></div>
    </section>
  </main>

  <footer class="footer">Â© 2025 steper music house</footer>

  <dialog id="editor">
    <form method="dialog" id="editForm">
      <div class="modal-head">
        <h3 id="editTitle">ê³¡ ì¶”ê°€</h3>
        <button id="closeDlg" type="button" class="btn-outline">âœ•</button>
      </div>
      <div class="grid2">
        <label>ì¹´í…Œê³ ë¦¬
          <select name="category" required>
            <option>hiphop</option>
            <option>kpop</option>
            <option>citypop</option>
            <option>jpop</option>
            <option>thaipop</option>
            <option>ins</option>
            <option>breaking</option>
            <option>jazz</option>
            <option value="rnb">r&amp;b</option>
          </select>
        </label>
        <label>ì œëª© <input name="title" placeholder="ê³¡/í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œëª©" required></label>
        <label>ì•„í‹°ìŠ¤íŠ¸ <input name="artist" placeholder="ì•„í‹°ìŠ¤íŠ¸/í¬ë¦¬ì—ì´í„°"></label>
        <label>URL <input name="url" placeholder="YouTube ë§í¬ (ë˜ëŠ” ê¸°íƒ€ ë§í¬)" required></label>
        <label>íƒœê·¸ <input name="tags" placeholder="ì˜ˆ: chill, oldschool, workout"></label>
        <label>ë©”ëª¨ <input name="note" placeholder="ì§§ì€ ì½”ë©˜íŠ¸"></label>
      </div>
      <div class="row" style="justify-content:flex-end; margin-top:12px; gap:8px">
        <button value="cancel" class="btn-outline">ì·¨ì†Œ</button>
        <button class="btn-primary" value="default">ì €ì¥</button>
      </div>
    </form>
  </dialog>

  <script>
    const STORAGE_KEY = "steper_music_house_local_v2";
    const CATS = ["hiphop","kpop","citypop","jpop","thaipop","ins","breaking","jazz","rnb"];
    const $ = (s)=>document.querySelector(s);
    const $$= (s)=>Array.from(document.querySelectorAll(s));
    let state = {items:[], createdAt:0};
    let local = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{"items": [], "createdAt": 0}');
    function saveLocal(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(local)); }
    function esc(s=""){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
    function escAttr(s=""){ return esc(s).replace(/\"/g,"&quot;"); }
    const p2 = (n)=> String(n).padStart(2,'0');
    function hDate(ts){ const d=new Date(ts); return `${d.getFullYear()}-${p2(d.getMonth()+1)}-${p2(d.getDate())}`; }

    function applyTheme(t){ document.documentElement.setAttribute('data-theme', t); localStorage.setItem('theme', t); }
    applyTheme(localStorage.getItem('theme')||'dark');
    $('#theme').addEventListener('click', ()=> applyTheme((localStorage.getItem('theme')||'dark')==='dark'?'light':'dark'));

    function ytId(url){
      try{ const u=new URL(url);
        if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
        if(u.searchParams.get('v')) return u.searchParams.get('v');
        if(u.pathname.startsWith('/shorts/')) return u.pathname.split('/')[2];
        if(u.pathname.startsWith('/embed/')) return u.pathname.split('/')[2];
      }catch(_){}
      return null;
    }
    function ytThumb(url){ const id=ytId(url); return id?`https://img.youtube.com/vi/${id}/hqdefault.jpg`:null; }

    function renderCatBar(){
      const bar = $('#catBar'); bar.innerHTML='';
      const all = document.createElement('button');
      all.className = 'chip active'; all.textContent = 'All'; all.dataset.cat='';
      bar.appendChild(all);
      for(const c of CATS){ const b=document.createElement('button'); b.className='chip'; b.textContent=c; b.dataset.cat=c; bar.appendChild(b); }
    }
    let activeCat=null;
    function setActiveCat(cat){
      activeCat = cat || null;
      $$(".chip").forEach(ch=> ch.classList.toggle('active', ch.dataset.cat===(activeCat||'')));
      renderList();
    }

    function sortItems(arr){
      const v = $('#sort').value;
      if(v==='addedAsc') return arr.sort((a,b)=>a.addedAt-b.addedAt);
      if(v==='titleAsc') return arr.sort((a,b)=>a.title.localeCompare(b.title));
      if(v==='titleDesc') return arr.sort((a,b)=>b.title.localeCompare(a.title));
      return arr.sort((a,b)=>b.addedAt-a.addedAt);
    }

    function mergedItems(){
      const map=new Map();
      for(const it of (state.items||[])) map.set(it.id, it);
      for(const it of (local.items||[])) map.set(it.id, it);
      return Array.from(map.values());
    }

    function renderList(){
      const list = $('#list'); const empty = $('#empty');
      let arr = mergedItems();
      if(activeCat) arr = arr.filter(x=>x.category===activeCat);
      const q = ($('#q').value||'').toLowerCase();
      if(q){ arr = arr.filter(x => (x.title+x.artist+x.note+(x.tags||[]).join(',')).toLowerCase().includes(q)); }
      const tfilter = ($('#tagFilter').value||'').toLowerCase().split(/[ ,#]+/).filter(Boolean);
      if(tfilter.length){ arr = arr.filter(x => tfilter.every(tf => (x.tags||[]).map(s=>s.toLowerCase()).includes(tf))); }
      sortItems(arr);
      list.innerHTML=''; if(empty) empty.style.display = arr.length? 'none':'block';
      for(const it of arr){
        const th = ytThumb(it.url);
        const card = document.createElement('article'); card.className='tile';
        card.innerHTML = `
          <div class="thumb">${th?`<img alt="thumb" loading="lazy" src="${th}">`:''}</div>
          <div class="body">
            <h3>${esc(it.title)}</h3>
            <div class="muted" style="display:flex; gap:8px; flex-wrap:wrap">
              <span class="pill">${esc(it.category)}</span>
              ${it.artist?`<span class="pill">${esc(it.artist)}</span>`:''}
              <span class="pill">${hDate(it.addedAt)}</span>
            </div>
            ${it.note?`<div class="muted">${esc(it.note)}</div>`:''}
            <div style="display:flex; gap:6px; flex-wrap:wrap">${(it.tags||[]).map(t=>`<span class="pill">#${esc(t)}</span>`).join(' ')}</div>
            <div class="actions">
              <button class="btn-open" data-open="${escAttr(it.url)}">ì—´ê¸°</button>
              <button class="btn-outline" data-edit="${it.id}">í¸ì§‘</button>
              <button class="btn-outline" data-del="${it.id}">ì‚­ì œ</button>
            </div>
          </div>`;
        list.appendChild(card);
      }
    }

    async function fetchRemote(){
      try{
        const res = await fetch('data/seed.json?ts='+Date.now(), {cache:'no-store'});
        if(res.ok){
          const incoming = await res.json();
          if(incoming && Array.isArray(incoming.items)){ state = incoming; }
        }
        renderList();
      }catch(e){ renderList(); }
    }

    document.addEventListener('keydown',(e)=>{ if(e.key==='/'){ e.preventDefault(); $('#q').focus(); }});
    $('#q').addEventListener('input', renderList);
    $('#tagFilter').addEventListener('input', renderList);
    $('#sort').addEventListener('change', renderList);
    document.addEventListener('click',(e)=>{
      const open = e.target.getAttribute('data-open');
      const eid  = e.target.getAttribute('data-edit');
      const del  = e.target.getAttribute('data-del');
      const cat  = e.target.closest('.chip')?.dataset.cat;
      if(open){ window.open(open,'_blank','noopener'); return; }
      if(eid){ const it = mergedItems().find(x=>x.id===eid); if(it) openEditor(it); return; }
      if(del){ if(confirm('ì‚­ì œí• ê¹Œìš”?')){ local.items = (local.items||[]).filter(x=>x.id!==del); saveLocal(); renderList(); } return; }
      if(cat!==undefined){ setActiveCat(cat); return; }
    });

    let editingId=null;
    function openEditor(item){
      editingId = item?.id || null;
      $('#editTitle').textContent = editingId ? 'ê³¡ ìˆ˜ì •' : 'ê³¡ ì¶”ê°€';
      const f = $('#editForm');
      f.category.value = item?.category || (activeCat || 'hiphop');
      f.title.value    = item?.title    || '';
      f.artist.value   = item?.artist   || '';
      f.url.value      = item?.url      || '';
      f.tags.value     = (item?.tags||[]).join(', ');
      f.note.value     = item?.note     || '';
      $('#editor').showModal();
    }
    $('#addBtn').addEventListener('click', ()=> openEditor());
    $('#closeDlg').addEventListener('click', ()=> $('#editor').close());
    $('#editForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const item = {
        id: editingId || crypto.randomUUID(),
        category: String(fd.get('category')).trim().toLowerCase(),
        title: (fd.get('title')||'').trim(),
        artist: (fd.get('artist')||'').trim(),
        url: (fd.get('url')||'').trim(),
        tags: (fd.get('tags')||'').split(/[ ,#]+/).map(s=>s.trim()).filter(Boolean),
        note: (fd.get('note')||'').trim(),
        addedAt: editingId ? (mergedItems().find(x=>x.id===editingId)?.addedAt || Date.now()) : Date.now(),
        updatedAt: Date.now()
      };
      if(!item.title || !item.url){ alert('ì œëª©ê³¼ URLì€ í•„ìˆ˜ì…ë‹ˆë‹¤.'); return; }
      const idx = (local.items||[]).findIndex(x=>x.id===item.id);
      if(idx>=0) local.items[idx]=item; else (local.items||(local.items=[])).unshift(item);
      saveLocal(); $('#editor').close(); renderList();
    });

    // Export
    $('#exportJSON').addEventListener('click', ()=>{
      const publish = { items: mergedItems(), createdAt: state.createdAt || Date.now() };
      const a=document.createElement('a');
      a.href=URL.createObjectURL(new Blob([JSON.stringify(publish,null,2)],{type:'application/json'}));
      a.download='seed.json';
      document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); },0);
    });

    renderCatBar();
    fetchRemote();
  </script>
</body>
</html>
