<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Music Link Vault â€” YouTube Organizer</title>
  <meta name="description" content="ë‚´ê°€ ìì£¼ ë“£ëŠ” ìŒì•…ì„ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì •ë¦¬í•˜ëŠ” ë‹¨ì¼ HTML ì €ì¥ì†Œ (YouTube ë§í¬ ì¤‘ì‹¬)" />
  <meta name="theme-color" content="#0b0e14" />
  <style>
    :root{--bg:#0b0e14;--panel:#111625;--card:#131a2b;--border:#26324a;--text:#e6eaf3;--muted:#9aa7bd;--accent:#60a5fa}
    :root[data-theme="light"]{--bg:#f6f9fc;--panel:#ffffff;--card:#ffffff;--border:#e5e9f2;--text:#0f172a;--muted:#5a6473}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    a{color:var(--accent);text-decoration:none}
    .header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg, rgba(12,18,30,.98), rgba(12,18,30,.92));border-bottom:1px solid var(--border)}
    :root[data-theme="light"] .header{background:linear-gradient(180deg,#fff,#f7fafc)}
    .wrap{max-width:1100px;margin:0 auto;padding:14px}
    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .grow{flex:1}
    .brand{display:flex;align-items:center;gap:8px}
    .brand .logo{font-size:22px}
    .brand h1{font-size:18px;margin:0}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .toolbar .chip{border:1px solid var(--border);background:var(--panel);color:var(--text);padding:6px 10px;border-radius:999px;cursor:pointer}
    .toolbar .chip.active{border-color:var(--accent);color:var(--accent)}
    .toolbar .chip:hover{opacity:.9}
    .controls{display:flex;gap:8px}
    .controls input,.controls button, .controls select{background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 10px}
    .controls button.primary{background:var(--accent);color:#0b0e14;border-color:transparent;font-weight:600}
    main{max-width:1100px;margin:18px auto;padding:0 14px;display:grid;gap:14px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 10px 26px rgba(0,0,0,.25)}
    .grid{display:grid;gap:14px}
    .grid-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media (max-width:900px){.grid-2{grid-template-columns:1fr}}
    .muted{color:var(--muted)}
    .pill{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px}
    .list{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    @media (max-width:1100px){.list{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:700px){.list{grid-template-columns:1fr}}
    .tile{border:1px solid var(--border);border-radius:12px;overflow:hidden;background:var(--panel);display:flex;flex-direction:column}
    .thumb{position:relative;padding-top:56%;background:#0b0e14}
    .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .tile .body{padding:10px;display:flex;flex-direction:column;gap:8px}
    .tile h3{margin:0;font-size:15px;line-height:1.4}
    .tile .meta{display:flex;gap:8px;flex-wrap:wrap}
    .tile .actions{display:flex;gap:8px;margin-top:auto}
    .tile button{background:transparent;border:1px solid var(--border);color:var(--text);padding:6px 8px;border-radius:10px;cursor:pointer}
    .tile button:hover{border-color:var(--accent)}
    .footer{border-top:1px solid var(--border);text-align:center;padding:16px;color:var(--muted)}
    .hidden{display:none}
    dialog{border:1px solid var(--border);border-radius:12px;background:var(--panel);color:var(--text);max-width:720px;width:92%}
    dialog::backdrop{background:rgba(0,0,0,.5)}
    .modal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .help{font-size:13px}
    .kbd{border:1px solid var(--border);padding:0 6px;border-radius:6px;background:var(--panel)}
    .section-title{display:flex;align-items:center;justify-content:space-between}
    .section-title .right{display:flex;gap:8px;align-items:center}
    .tag{padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px}
    .filterbar{display:flex;gap:8px;flex-wrap:wrap}
  </style>
</head>
<body>
  <header class="header">
    <div class="wrap row">
      <div class="brand">
        <span class="logo">ğŸµ</span>
        <h1>Music Link Vault</h1>
        <span class="muted">(YouTube ì¤‘ì‹¬)</span>
      </div>
      <div class="toolbar grow" id="catBar"></div>
      <div class="controls">
        <input id="q" placeholder="ê²€ìƒ‰: ì œëª©/ì•„í‹°ìŠ¤íŠ¸/íƒœê·¸/ë©”ëª¨ ( / )" />
        <select id="sort">
          <option value="addedDesc">ìµœì‹ ìˆœ</option>
          <option value="addedAsc">ì˜¤ë˜ëœìˆœ</option>
          <option value="titleAsc">ì œëª© Aâ†’Z</option>
          <option value="titleDesc">ì œëª© Zâ†’A</option>
        </select>
        <button id="theme" title="í…Œë§ˆ ì „í™˜">ğŸŒ“</button>
        <button id="addBtn" class="primary">ì¶”ê°€</button>
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="section-title">
        <h2>ë‚´ ë¦¬ìŠ¤íŠ¸</h2>
        <div class="right filterbar">
          <input id="tagFilter" placeholder="#íƒœê·¸ í•„í„° (ì‰¼í‘œ/ìŠ¤í˜ì´ìŠ¤)" />
          <button id="exportJSON">JSON ë‚´ë³´ë‚´ê¸°</button>
          <label><input type="file" id="importJSON" accept="application/json" hidden> <span class="pill">JSON ë¶ˆëŸ¬ì˜¤ê¸°</span></label>
        </div>
      </div>
      <div id="empty" class="muted">ì•„ì§ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. ìš°ì¸¡ ìƒë‹¨ì˜ <b>ì¶”ê°€</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ì²« ê³¡ì„ ë“±ë¡í•´ë³´ì„¸ìš”.</div>
      <div id="list" class="list"></div>
    </section>

    <section class="card help">
      <details>
        <summary>ë„ì›€ë§/ë‹¨ì¶•í‚¤ ë³´ê¸°</summary>
        <ul>
          <li><span class="kbd">/</span> : ê²€ìƒ‰ì°½ í¬ì»¤ìŠ¤</li>
          <li>ì¹´í…Œê³ ë¦¬ ì¹© í´ë¦­: í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë§Œ ë³´ê¸° (ë‹¤ì‹œ í´ë¦­ì‹œ í•´ì œ)</li>
          <li>íƒœê·¸ í•„í„°: <code>#hiphop, #rnb</code> ì²˜ëŸ¼ ì—¬ëŸ¬ ê°œ ì…ë ¥ ê°€ëŠ¥</li>
          <li>YouTube ì¸ë„¤ì¼ì€ ë§í¬ì—ì„œ ì˜ìƒ IDë¥¼ ìë™ ì¶”ì¶œí•´ í‘œì‹œí•©ë‹ˆë‹¤.</li>
        </ul>
      </details>
    </section>
  </main>

  <footer class="footer">Â© 2025 Music Link Vault â€” Singleâ€‘file. ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €(LocalStorage)ì— ì €ì¥ë©ë‹ˆë‹¤.</footer>

  <!-- Add/Edit Modal -->
  <dialog id="editor">
    <form method="dialog" id="editForm">
      <div class="modal-head">
        <h3 id="editTitle">ë§í¬ ì¶”ê°€</h3>
        <button id="closeDlg" type="button">âœ•</button>
      </div>
      <div class="grid grid-2">
        <label>ì¹´í…Œê³ ë¦¬
          <select name="category" required>
            <option>hiphop</option>
            <option>kpop</option>
            <option>citypop</option>
            <option>jpop</option>
            <option>thaipop</option>
            <option>ins</option>
            <option>breaking</option>
            <option>jazz</option>
            <option value="rnb">r&amp;b</option>
          </select>
        </label>
        <label>ì œëª© <input name="title" placeholder="ê³¡/í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì œëª©" required></label>
        <label>ì•„í‹°ìŠ¤íŠ¸ <input name="artist" placeholder="ì•„í‹°ìŠ¤íŠ¸/í¬ë¦¬ì—ì´í„°"></label>
        <label>URL <input name="url" placeholder="YouTube ë§í¬ (ë˜ëŠ” ê¸°íƒ€ ë§í¬)" required></label>
        <label>íƒœê·¸ <input name="tags" placeholder="ì˜ˆ: chill, oldschool, workout"></label>
        <label>ë©”ëª¨ <input name="note" placeholder="ì§§ì€ ì½”ë©˜íŠ¸"></label>
      </div>
      <div class="row" style="justify-content:flex-end;margin-top:12px;gap:8px">
        <button value="cancel">ì·¨ì†Œ</button>
        <button class="primary" value="default">ì €ì¥</button>
      </div>
    </form>
  </dialog>

  <script>
    // ====== Data & Utils ======
    const STORAGE_KEY = "music_repo_v1";
    const CATS = ["hiphop","kpop","citypop","jpop","thaipop","ins","breaking","jazz","rnb"]; // r&b -> rnb
    const $ = (s)=>document.querySelector(s);
    const $$= (s)=>Array.from(document.querySelectorAll(s));

    function load(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {items:[], createdAt: Date.now()}; }
      catch { return {items:[], createdAt: Date.now()}; }
    }
    function save(st){ localStorage.setItem(STORAGE_KEY, JSON.stringify(st)); }
    let state = load();

    function esc(s=""){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
    function escAttr(s=""){ return esc(s).replace(/\"/g,"&quot;"); }
    const p2 = (n)=> String(n).padStart(2,'0');
    function hDate(ts){ const d=new Date(ts); return `${d.getFullYear()}-${p2(d.getMonth()+1)}-${p2(d.getDate())}`; }

    // Extract YouTube video id from many formats
    function ytId(url){
      try {
        const u = new URL(url);
        if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
        if(u.searchParams.get('v')) return u.searchParams.get('v');
        // Shorts
        if(u.pathname.startsWith('/shorts/')) return u.pathname.split('/')[2];
        // Embed
        if(u.pathname.startsWith('/embed/')) return u.pathname.split('/')[2];
      } catch(_) {}
      return null;
    }
    function ytThumb(url){
      const id = ytId(url);
      return id ? `https://img.youtube.com/vi/${id}/hqdefault.jpg` : null;
    }

    // ====== Theme ======
    function applyTheme(t){ document.documentElement.setAttribute('data-theme', t); localStorage.setItem('theme', t); }
    applyTheme(localStorage.getItem('theme')||'dark');
    $('#theme').addEventListener('click', ()=> applyTheme((localStorage.getItem('theme')||'dark')==='dark'?'light':'dark'));

    // ====== Category bar ======
    let activeCat = null;
    function renderCatBar(){
      const bar = $('#catBar');
      bar.innerHTML = '';
      const all = document.createElement('button');
      all.className = 'chip' + (!activeCat ? ' active' : '');
      all.textContent = 'All';
      all.onclick = ()=>{ activeCat=null; renderList(); renderCatBar(); };
      bar.appendChild(all);
      for(const c of CATS){
        const b = document.createElement('button');
        b.className = 'chip' + (activeCat===c?' active':'');
        b.textContent = c;
        b.onclick = ()=>{ activeCat = activeCat===c ? null : c; renderList(); renderCatBar(); };
        bar.appendChild(b);
      }
    }

    // ====== Add/Edit ======
    let editingId = null;
    $('#addBtn').addEventListener('click', ()=> openEditor());
    $('#closeDlg').addEventListener('click', ()=> $('#editor').close());

    function openEditor(item){
      editingId = item?.id || null;
      $('#editTitle').textContent = editingId ? 'ë§í¬ ìˆ˜ì •' : 'ë§í¬ ì¶”ê°€';
      const f = $('#editForm');
      f.category.value = item?.category || (activeCat || 'hiphop');
      f.title.value    = item?.title    || '';
      f.artist.value   = item?.artist   || '';
      f.url.value      = item?.url      || '';
      f.tags.value     = (item?.tags||[]).join(', ');
      f.note.value     = item?.note     || '';
      $('#editor').showModal();
    }

    $('#editForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const item = {
        id: editingId || crypto.randomUUID(),
        category: String(fd.get('category')).trim().toLowerCase(),
        title: (fd.get('title')||'').trim(),
        artist: (fd.get('artist')||'').trim(),
        url: (fd.get('url')||'').trim(),
        tags: (fd.get('tags')||'').split(/[ ,#]+/).map(s=>s.trim()).filter(Boolean),
        note: (fd.get('note')||'').trim(),
        addedAt: editingId ? (state.items.find(x=>x.id===editingId)?.addedAt || Date.now()) : Date.now(),
        updatedAt: Date.now()
      };
      if(!item.title || !item.url){ alert('ì œëª©ê³¼ URLì€ í•„ìˆ˜ì…ë‹ˆë‹¤.'); return; }
      if(!CATS.includes(item.category)) item.category = 'hiphop';
      const i = state.items.findIndex(x=>x.id===item.id);
      if(i>=0){ state.items[i] = item; } else { state.items.unshift(item); }
      save(state); $('#editor').close(); renderList();
    });

    // ====== Listing / Filters ======
    function sortItems(arr){
      const v = $('#sort').value;
      if(v==='addedAsc') return arr.sort((a,b)=>a.addedAt-b.addedAt);
      if(v==='titleAsc') return arr.sort((a,b)=>a.title.localeCompare(b.title));
      if(v==='titleDesc') return arr.sort((a,b)=>b.title.localeCompare(a.title));
      return arr.sort((a,b)=>b.addedAt-a.addedAt);
    }

    function renderList(){
      const list = $('#list');
      const empty = $('#empty');
      let arr = state.items.slice();
      // category
      if(activeCat) arr = arr.filter(x=>x.category===activeCat);
      // search
      const q = ($('#q').value||'').toLowerCase();
      if(q){
        arr = arr.filter(x => (x.title+x.artist+x.note+(x.tags||[]).join(',')).toLowerCase().includes(q));
      }
      // tag filter
      const tfilter = ($('#tagFilter').value||'').toLowerCase().split(/[ ,#]+/).filter(Boolean);
      if(tfilter.length){
        arr = arr.filter(x => tfilter.every(tf => (x.tags||[]).map(s=>s.toLowerCase()).includes(tf)));
      }
      sortItems(arr);
      list.innerHTML = '';
      empty.classList.toggle('hidden', arr.length>0);
      if(!arr.length) return;

      for(const it of arr){
        const card = document.createElement('article');
        card.className = 'tile';
        const th = ytThumb(it.url);
        card.innerHTML = `
          <div class="thumb">${th?`<img alt="thumb" loading="lazy" src="${th}">`:''}</div>
          <div class="body">
            <h3>${esc(it.title)}</h3>
            <div class="meta muted">
              <span class="pill">${esc(it.category)}</span>
              ${it.artist?`<span class="pill">${esc(it.artist)}</span>`:''}
              <span class="pill">${hDate(it.addedAt)}</span>
            </div>
            ${it.note?`<div class="muted">${esc(it.note)}</div>`:''}
            <div class="meta">${(it.tags||[]).map(t=>`<span class="tag">#${esc(t)}</span>`).join(' ')}</div>
            <div class="actions">
              <button data-open="${escAttr(it.url)}">ì—´ê¸°</button>
              <button data-edit="${it.id}">í¸ì§‘</button>
              <button data-del="${it.id}">ì‚­ì œ</button>
            </div>
          </div>`;
        list.appendChild(card);
      }
    }

    // search shortcuts
    document.addEventListener('keydown', (e)=>{ if(e.key === '/') { e.preventDefault(); $('#q').focus(); }});
    $('#q').addEventListener('input', renderList);
    $('#tagFilter').addEventListener('input', renderList);
    $('#sort').addEventListener('change', renderList);

    // actions (open/edit/delete)
    document.addEventListener('click', (e)=>{
      const open = e.target.getAttribute('data-open');
      const eid  = e.target.getAttribute('data-edit');
      const del  = e.target.getAttribute('data-del');
      if(open){ window.open(open, '_blank', 'noopener'); }
      else if(eid){ const it = state.items.find(x=>x.id===eid); if(it) openEditor(it); }
      else if(del){ if(confirm('ì‚­ì œí• ê¹Œìš”?')){ state.items = state.items.filter(x=>x.id!==del); save(state); renderList(); }}
    });

    // ====== Import/Export ======
    $('#exportJSON').addEventListener('click', ()=>{
      const a = document.createElement('a');
      a.href = URL.createObjectURL(new Blob([JSON.stringify(state,null,2)], {type:'application/json'}));
      a.download = 'music-links.json';
      document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
    });
    $('#importJSON').addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return; const r = new FileReader();
      r.onload = ()=>{
        try{ const incoming = JSON.parse(r.result);
          if(!incoming || typeof incoming!== 'object' || !Array.isArray(incoming.items)) throw new Error('bad');
          state = incoming; save(state); renderList(); alert('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ');
        }catch{ alert('ìœ íš¨í•œ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.'); }
      };
      r.readAsText(f);
    });

    // ====== Boot ======
    renderCatBar();
    renderList();
  </script>
</body>
</html>
