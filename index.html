<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Music Link Vault â€” Public</title>
  <meta name="description" content="ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì •ë¦¬ëœ ìœ íŠœë¸Œ ìŒì•… ë§í¬ â€” ê³µê°œ ë²„ì „" />
  <meta name="theme-color" content="#0b0e14" />
  <style>
    :root{--bg:#0b0e14;--panel:#0f1520;--card:#111725;--border:#26324a;--text:#e6eaf3;--muted:#9aa7bd;--accent:#60a5fa}
    :root[data-theme="light"]{--bg:#f6f9fc;--panel:#ffffff;--card:#ffffff;--border:#e5e9f2;--text:#0f172a;--muted:#5a6473}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    a{color:var(--accent);text-decoration:none}
    .header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg, rgba(12,18,30,.98), rgba(12,18,30,.92));border-bottom:1px solid var(--border)}
    :root[data-theme="light"] .header{background:linear-gradient(180deg,#fff,#f7fafc)}
    .wrap{max-width:1100px;margin:0 auto;padding:14px}
    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .grow{flex:1}
    .brand{display:flex;align-items:center;gap:8px}
    .brand .logo{font-size:22px}
    .brand h1{font-size:18px;margin:0}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .toolbar .chip{border:1px solid var(--border);background:var(--panel);color:var(--text);padding:6px 10px;border-radius:999px;cursor:pointer}
    .toolbar .chip.active{border-color:var(--accent);color:var(--accent)}
    .controls{display:flex;gap:8px}
    .controls input,.controls button, .controls select{background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 10px}
    .controls button.primary{background:var(--accent);color:#0b0e14;border-color:transparent;font-weight:600}
    main{max-width:1100px;margin:18px auto;padding:0 14px;display:grid;gap:14px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 10px 26px rgba(0,0,0,.25)}
    .grid{display:grid;gap:14px}
    .list{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    @media (max-width:1100px){.list{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:700px){.list{grid-template-columns:1fr}}
    .tile{border:1px solid var(--border);border-radius:12px;overflow:hidden;background:var(--panel);display:flex;flex-direction:column}
    .thumb{position:relative;padding-top:56%;background:#0b0e14}
    .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .tile .body{padding:10px;display:flex;flex-direction:column;gap:8px}
    .tile h3{margin:0;font-size:15px;line-height:1.4}
    .tile .meta{display:flex;gap:8px;flex-wrap:wrap}
    .tile .actions{display:flex;gap:8px;margin-top:auto}
    .tile button{background:transparent;border:1px solid var(--border);color:var(--text);padding:6px 8px;border-radius:10px;cursor:pointer}
    .tile button:hover{border-color:var(--accent)}
    .footer{border-top:1px solid var(--border);text-align:center;padding:16px;color:var(--muted)}
    .pill{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px}
    .muted{color:var(--muted)}
    .filterbar{display:flex;gap:8px;flex-wrap:wrap}
    dialog{border:1px solid var(--border);border-radius:12px;background:var(--panel);color:var(--text);max-width:720px;width:92%}
    dialog::backdrop{background:rgba(0,0,0,.5)}
  </style>
</head>
<body>
  <header class="header">
    <div class="wrap row">
      <div class="brand">
        <span class="logo">ğŸµ</span>
        <h1>Music Link Vault (Public)</h1>
        <span class="muted">â€” YouTube ì¤‘ì‹¬</span>
      </div>
      <div class="toolbar grow" id="catBar"></div>
      <div class="controls">
        <input id="q" placeholder="ê²€ìƒ‰: ì œëª©/ì•„í‹°ìŠ¤íŠ¸/íƒœê·¸/ë©”ëª¨ ( / )" />
        <select id="sort">
          <option value="addedDesc">ìµœì‹ ìˆœ</option>
          <option value="addedAsc">ì˜¤ë˜ëœìˆœ</option>
          <option value="titleAsc">ì œëª© Aâ†’Z</option>
          <option value="titleDesc">ì œëª© Zâ†’A</option>
        </select>
        <button id="theme" title="í…Œë§ˆ ì „í™˜">ğŸŒ“</button>
        <button id="sync" class="primary">ì›ê²© ë™ê¸°í™”</button>
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>ê³µê°œ ë¦¬ìŠ¤íŠ¸</h2>
        <div class="filterbar">
          <input id="tagFilter" placeholder="#íƒœê·¸ í•„í„° (ì‰¼í‘œ/ìŠ¤í˜ì´ìŠ¤)" />
          <button id="exportJSON">ê³µê°œ ì—…ë°ì´íŠ¸ìš© JSON ë‹¤ìš´ë¡œë“œ</button>
          <label><input type="file" id="importJSON" accept="application/json" hidden> <span class="pill">JSON ë¯¸ë¦¬ë³´ê¸°</span></label>
        </div>
      </div>
      <div id="empty" class="muted">ì•„ì§ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. ìš°ì¸¡ ìƒë‹¨ì˜ <b>ì›ê²© ë™ê¸°í™”</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¦¬í¬ì˜ <code>data/seed.json</code>ì„ ê°€ì ¸ì˜¤ì„¸ìš”.</div>
      <div id="list" class="list"></div>
    </section>

    <section class="card">
      <details>
        <summary>ê³µê°œ ì—…ë°ì´íŠ¸ ë°©ë²•</summary>
        <ol>
          <li>ìƒë‹¨ ì˜¤ë¥¸ìª½ <b>JSON ë‹¤ìš´ë¡œë“œ</b> ë²„íŠ¼ìœ¼ë¡œ íŒŒì¼ ì €ì¥ (<code>seed.json</code>)</li>
          <li>GitHub ì €ì¥ì†Œì—ì„œ <code>data/seed.json</code> ê²½ë¡œì— ì—…ë¡œë“œ(Commit)</li>
          <li>ì‚¬ì´íŠ¸ì—ì„œ <b>ì›ê²© ë™ê¸°í™”</b> ë²„íŠ¼ í´ë¦­ â†’ ì „ì²´ ë™ê¸°í™” ì™„ë£Œ</li>
        </ol>
      </details>
    </section>
  </main>

  <footer class="footer">Â© 2025 Music Link Vault â€” Public. ë°ì´í„°ëŠ” ë¦¬í¬ì§€í† ë¦¬ì˜ <code>data/seed.json</code>ì—ì„œ ë¡œë“œë©ë‹ˆë‹¤.</footer>

  <script>
    const STORAGE_KEY = "music_repo_public_cache_v1";
    const CATS = ["hiphop","kpop","citypop","jpop","thaipop","ins","breaking","jazz","rnb"];
    const $ = (s)=>document.querySelector(s);
    const $$= (s)=>Array.from(document.querySelectorAll(s));

    let state = {items:[], createdAt:0};

    function esc(s=""){ return s.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
    function escAttr(s=""){ return esc(s).replace(/\"/g,"&quot;"); }
    const p2 = (n)=> String(n).padStart(2,'0');
    function hDate(ts){ const d=new Date(ts); return `${d.getFullYear()}-${p2(d.getMonth()+1)}-${p2(d.getDate())}`; }

    function applyTheme(t){ document.documentElement.setAttribute('data-theme', t); localStorage.setItem('theme', t); }
    applyTheme(localStorage.getItem('theme')||'dark');
    $('#theme').addEventListener('click', ()=> applyTheme((localStorage.getItem('theme')||'dark')==='dark'?'light':'dark'));

    function renderCatBar(){
      const bar = $('#catBar'); bar.innerHTML='';
      const all = document.createElement('button');
      all.className = 'chip active'; all.textContent = 'All';
      all.dataset.cat = ''; bar.appendChild(all);
      for(const c of CATS){ const b=document.createElement('button'); b.className='chip'; b.textContent=c; b.dataset.cat=c; bar.appendChild(b); }
    }

    let activeCat = null;
    function setActiveCat(cat){
      activeCat = cat || null;
      $$(".toolbar .chip").forEach(ch=> ch.classList.toggle('active', ch.dataset.cat===(activeCat||'')));
      renderList();
    }

    function sortItems(arr){
      const v = $('#sort').value;
      if(v==='addedAsc') return arr.sort((a,b)=>a.addedAt-b.addedAt);
      if(v==='titleAsc') return arr.sort((a,b)=>a.title.localeCompare(b.title));
      if(v==='titleDesc') return arr.sort((a,b)=>b.title.localeCompare(a.title));
      return arr.sort((a,b)=>b.addedAt-a.addedAt);
    }

    function ytId(url){
      try{
        const u=new URL(url);
        if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
        if(u.searchParams.get('v')) return u.searchParams.get('v');
        if(u.pathname.startsWith('/shorts/')) return u.pathname.split('/')[2];
        if(u.pathname.startsWith('/embed/')) return u.pathname.split('/')[2];
      }catch(_){}
      return null;
    }
    function ytThumb(url){ const id=ytId(url); return id?`https://img.youtube.com/vi/${id}/hqdefault.jpg`:null; }

    function renderList(){
      const list = $('#list'); const empty = $('#empty');
      let arr = state.items.slice();
      if(activeCat) arr = arr.filter(x=>x.category===activeCat);
      const q = ($('#q').value||'').toLowerCase();
      if(q){ arr = arr.filter(x => (x.title+x.artist+x.note+(x.tags||[]).join(',')).toLowerCase().includes(q)); }
      const tfilter = ($('#tagFilter').value||'').toLowerCase().split(/[ ,#]+/).filter(Boolean);
      if(tfilter.length){ arr = arr.filter(x => tfilter.every(tf => (x.tags||[]).map(s=>s.toLowerCase()).includes(tf))); }
      sortItems(arr);
      list.innerHTML=''; empty.style.display = arr.length? 'none':'block';
      for(const it of arr){
        const card = document.createElement('article'); card.className='tile';
        const th = ytThumb(it.url);
        card.innerHTML = `
          <div class="thumb">${th?`<img alt="thumb" loading="lazy" src="${th}">`:''}</div>
          <div class="body">
            <h3>${esc(it.title)}</h3>
            <div class="meta muted">
              <span class="pill">${esc(it.category)}</span>
              ${it.artist?`<span class="pill">${esc(it.artist)}</span>`:''}
              <span class="pill">${hDate(it.addedAt)}</span>
            </div>
            ${it.note?`<div class="muted">${esc(it.note)}</div>`:''}
            <div class="meta">${(it.tags||[]).map(t=>`<span class="pill">#${esc(t)}</span>`).join(' ')}</div>
            <div class="actions">
              <button data-open="${escAttr(it.url)}">ì—´ê¸°</button>
            </div>
          </div>`;
        list.appendChild(card);
      }
    }

    document.addEventListener('keydown',(e)=>{ if(e.key==='/'){ e.preventDefault(); $('#q').focus(); }});
    $('#q').addEventListener('input', renderList);
    $('#tagFilter').addEventListener('input', renderList);
    $('#sort').addEventListener('change', renderList);
    document.addEventListener('click',(e)=>{
      const open = e.target.getAttribute('data-open');
      if(open){ window.open(open,'_blank','noopener'); return; }
      const cat = e.target.closest('.chip')?.dataset.cat;
      if(cat!==undefined){ setActiveCat(cat); }
    });

    async function fetchRemote(){
      try{
        const res = await fetch('data/seed.json?ts='+Date.now(), {cache:'no-store'});
        if(!res.ok) throw new Error('seed.json not found');
        const incoming = await res.json();
        if(!incoming || !Array.isArray(incoming.items)) throw new Error('bad schema');
        state = incoming;
        localStorage.setItem(STORAGE_KEY, JSON.stringify({cachedAt: Date.now(), state}));
        renderList();
        alert('ì›ê²© ë™ê¸°í™” ì™„ë£Œ');
      }catch(e){
        const cache = JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
        if(cache.state){ state = cache.state; renderList(); alert('ì›ê²©ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•´ ìºì‹œë¡œ í‘œì‹œí•©ë‹ˆë‹¤.'); }
        else alert('ì›ê²© ë™ê¸°í™” ì‹¤íŒ¨: data/seed.json í™•ì¸ í•„ìš”');
      }
    }

    $('#sync').addEventListener('click', fetchRemote);

    $('#exportJSON').addEventListener('click', ()=>{
      const a=document.createElement('a');
      a.href=URL.createObjectURL(new Blob([JSON.stringify(state,null,2)],{type:'application/json'}));
      a.download='seed.json';
      document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); },0);
    });
    $('#importJSON').addEventListener('change',(e)=>{
      const f=e.target.files[0]; if(!f) return; const r=new FileReader();
      r.onload=()=>{ try{ const x=JSON.parse(r.result); if(!x||!Array.isArray(x.items)) throw 0; state=x; renderList(); alert('ë¯¸ë¦¬ë³´ê¸° ë¡œë“œ ì™„ë£Œ (ê³µê°œ ë°˜ì˜ì€ GitHubì— seed.json ì—…ë¡œë“œ í•„ìš”)'); }catch{ alert('ìœ íš¨í•œ JSONì´ ì•„ë‹™ë‹ˆë‹¤.'); } };
      r.readAsText(f);
    });

    renderCatBar();
    fetchRemote();
  </script>
</body>
</html>